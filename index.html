<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Orbit Menu — Cards Only + Center Dotted Lines</title>
<style>
  :root{
    --bg1:#072a44; --bg2:#0b4e68;
    --radius: 520px;          /* card spacing & ring size */
    --tilt: -35;              /* virtual tilt for shaping only */
    --card-tilt-follow: 0.6;  /* 0 = flatter, 1 = hug arc */
    --orbit-shift: -10px;     /* raise/lower the group */
    --card-w: 220px;
    --min-scale: .72; --max-blur: 6px; --min-opacity: .60;
    --perspective: 1400px; --duration: 620ms;

    /* Dotted spoke style */
    --spoke-color: #d9f4ff55;
    --spoke-width: 2.5;
    --spoke-dot: 6;
    --spoke-gap: 10;
    --spoke-start-gap: 0;   /* px away from center icon */
    --spoke-end-gap: 30;   /* px before card center */
  
    --icon-right-pad: 6px;
  
    --icon-scale: 0.75;
  
    --icon-size: 64px;
  }

  html,body{height:100%;margin:0}
  body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
       background: radial-gradient(1200px 1200px at 70% 20%, var(--bg2), var(--bg1));
       color:#eaf8ff; overflow:hidden}
  .wrap{position:relative;height:100%;display:grid;place-items:center;user-select:none}
  .scene{position:relative;width:min(1200px,96vw);height:min(720px,75vh);perspective:var(--perspective);perspective-origin:50% 50%;overflow:visible}
  .world{position:absolute;inset:0;transform-style:preserve-3d}

  .orbit{position:absolute;inset:0;transform: translateY(var(--orbit-shift));transform-style:preserve-3d;z-index:2}

  /* SVG spokes live behind cards */
  .spoke-svg{ position:absolute; inset:0; z-index:1; pointer-events:none; }


  /* Curved ring arcs behind cards */
  .ring-svg{ position:absolute; inset:0; z-index:1; pointer-events:none; }
  /* CARDS ring */
  .cards-ring{position:absolute;inset:0;transform-style:preserve-3d;z-index:2}
  .node{position:absolute;left:50%;top:50%;transform-style:preserve-3d;pointer-events:auto}
  .card{position:absolute;left:0;top:0;width:var(--card-w);transform:translate(-50%, -50%) scale(1);
        background:transparent;border:none;display:flex;flex-direction:column;align-items:center;gap:12px;
        padding:10px 6px;text-align:center;cursor:pointer;backface-visibility:hidden}
  .ico{width:64px;height:64px;border-radius:18px;display:grid;place-items:center;
       background: transparent;box-shadow: none;
       font-size:30px overflow:visible;}
  \1
  .ico svg.padded{transform: translateX(calc(-1 * var(--icon-right-pad))) scale(calc(var(--icon-scale) * 0.92));transform-origin:50% 50%;}
  .card h3{margin:0;font-size:clamp(16px,1.6vw,22px);font-weight: 600;letter-spacing:.3px;line-height:1.1;color:#eaf8ff;text-shadow:0 2px 12px #0009}

  /* Hub */
  .hub{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;z-index:3;pointer-events:none}
  .hubbtn{background:none;border:none;cursor:pointer;color:inherit;padding:0;text-align:center;pointer-events:auto}
  .hub .shield{width:72px;height:72px;border-radius:18px;border:2px solid #9fe6ff33;display:grid;place-items:center;margin:0 auto 10px;box-shadow:0 0 40px #0ff2ff22 inset,0 0 18px #0ff2ff33}
  .hub .shield::before{content:"☁️";font-size:34px;filter:drop-shadow(0 0 6px #0ff)}
  .hub h1{margin:4px 0 0;font-weight:800;letter-spacing:.6px;font-size:clamp(26px,3.4vw,48px);line-height:1.05;color:#eaf8ff;text-shadow:0 2px 16px #0009}
  .hub small{display:block;opacity:.8;letter-spacing:.2px;margin-top:2px}

  /* Controls */
  .controls{position:absolute;bottom:24px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:16px}
  .btn{pointer-events:auto;width:46px;height:46px;border-radius:12px;background:#ffffff15;border:1px solid #9fe6ff2a;display:grid;place-items:center;cursor:pointer;box-shadow:0 6px 18px #0007,0 0 0 1px #ffffff10 inset}
  .btn svg{width:22px;height:22px;fill:#bff1ff}
  .progress{width:360px;height:4px;border-radius:99px;background:#ffffff14;overflow:hidden}
  .progress .bar{height:100%;width:0%;background:linear-gradient(90deg,#6fe3ff,#0cc3ff);transition:width var(--duration) cubic-bezier(.2,.8,.2,1)}
</style>
<style id="thin-text-override">
  /* Make all text thinner */
  body, p, a, li, button, input, label, span, strong, em, small, div, h1, h2, h3, h4, h5, h6 {
    font-weight: 300 !important;
  }
</style>
<style id="no-text-shadow-override">
  /* Remove text shadows from all common text elements */
  body, p, a, li, button, input, label, span, strong, em, small, div, h1, h2, h3, h4, h5, h6 {
    text-shadow: none !important;
  }
</style>
<style id="orbit-tilt-override">
  :root { --tilt: -28; } /* previously -35; slightly flatter so the front item isn't near the bottom */
</style>
<style id="brand-logo-style">
  .brand-logo{
    position:absolute; 
    top:28px; 
    left:50%; 
    transform:translateX(-50%);
    width:180px; /* size matched to reference screenshot */
    height:auto;
    z-index:12;
    pointer-events:none;
  }
</style>
<style id="hub-logo-replace-style">
  /* Hide old center elements */
  .hub .shield, .hub h1, .hub small { display: none !important; }
  /* New center logo */
  .hub .hub-logo {
    width: 32px;
    height: 32px;
    display: block;
    margin: 0 auto;
    pointer-events: none;
    margin-top: -30px;
  }
</style>
<style id="spoke-dots-override">
  :root {
    --spoke-dot: 3;  /* was 6 */
    --spoke-gap: 5;  /* was 10 */
  }
</style>
<style id="module-modal-style">
  .module-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:20;}
  .module-modal.open{display:flex;}
  .module-backdrop{position:absolute;inset:0;background:#00131e99;opacity:0;transition:opacity var(--duration,600ms) ease;}
  .module-modal.open .module-backdrop{opacity:1;}
  .module-card{position:relative;background:linear-gradient(180deg,#0a3a57,#0a2f46);border-radius:14px;border:2px dashed #ffffff45;
               box-shadow:0 26px 70px #0009, 0 0 0 1px #ffffff20 inset;color:#eaf8ff;min-width:640px;max-width:900px;padding:28px 28px 26px;opacity:0;transform:translateY(-8px);
               transition:opacity var(--duration,600ms) cubic-bezier(.2,.8,.2,1), transform var(--duration,600ms) cubic-bezier(.2,.8,.2,1);}
  .module-modal.open .module-card{opacity:1;transform:translateY(0);}
  .module-close{position:absolute;top:12px;right:14px;background:none;border:0;color:inherit;cursor:pointer;font-size:26px;opacity:.9;line-height:1}
  .module-head{display:flex;align-items:center;gap:14px;margin-bottom:14px}
  .module-ico{width:28px;height:28px;opacity:.95}
  .module-title{font-size:40px;line-height:1.1;margin:0 0 8px}
  .module-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:10px}
  .menu-pill{display:flex;align-items:center;justify-content:center;padding:16px 18px;border-radius:999px;border:2px solid #ffffff55;background:transparent;color:#eaf8ff;font-size:20px;letter-spacing:.2px;cursor:pointer}
  .menu-pill:hover{background:#ffffff12}
  @media (max-width:820px){ .module-card{min-width:92vw; padding:22px} .module-title{font-size:28px} .module-grid{grid-template-columns:1fr} }
</style>
<style id="ico-overflow-fix">
  .ico{ overflow: visible; }
  .ico svg{ overflow: visible; }
  /* tiny universal inset to avoid pixel clipping on the right due to subpixel rounding */
  .ico svg.padded{ transform: translateX(-0.5px) scale(calc(var(--icon-scale, 1) * 0.96)); transform-origin:50% 50%; }
</style>
<style id="card-text-gap-override">
  /* Slightly reduce space between icon and label on cards */
  .card{ gap: 17px; }
</style>
</head>
<body>
<img alt="NicheRMS365 logo" class="brand-logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTA3IiBoZWlnaHQ9IjIyNiIgdmlld0JveD0iMCAwIDExMDcgMjI2Ij4KICA8cGF0aCBkPSJNIDIyMiA0MyBMIDIxNyA0OSBMIDIxNyAxODEgTCAyMTggMTgzIEwgMjIzIDE4NyBMIDM1MyAxODcgTCAzNTggMTgxIEwgMzU4IDQ5IEwgMzU2IDQ1IEwgMzUwIDQyIEwgMjI1IDQyIFogTSAyNzQgMjkgTCAyNjAgMTYgTCAyNDQgNyBMIDIyNiAyIEwgMjE4IDIgTCAyMTcgMCBMIDIxMCAwIEwgMjA5IDIgTCAyMDAgMiBMIDE5OSAzIEwgMTkxIDQgTCAxNzQgMTEgTCAxNjEgMjAgTCAxNTAgMzEgTCAxNDMgNDAgTCAxMjkgMzYgTCAxMDkgMzYgTCA5NyAzOSBMIDg2IDQ0IEwgNzYgNTEgTCA2NyA2MCBMIDYwIDcwIEwgNTQgODMgTCA1MSA5NyBMIDQ5IDk5IEwgNDYgOTkgTCAzNSAxMDMgTCAyMyAxMTEgTCAxMyAxMjIgTCA2IDEzNCBMIDIgMTQ2IEwgMiAxNTEgTCAwIDE1MiBMIDAgMTcyIEwgMiAxNzMgTCAyIDE3NyBMIDUgMTg3IEwgMTEgMTk5IEwgMTkgMjA5IEwgMjYgMjE1IEwgNDAgMjIzIEwgNDcgMjI1IEwgMjk3IDIyNSBMIDMwNiAyMjIgTCAzMTUgMjE3IEwgMzI5IDIwNCBMIDMzMSAyMDAgTCAzMDYgMjAwIEwgMjk2IDIwNiBMIDI4OSAyMDggTCA1NSAyMDggTCA0OCAyMDYgTCAzNiAxOTkgTCAyNSAxODYgTCAyMCAxNzMgTCAxOSAxNTYgTCAyMiAxNDQgTCAyNiAxMzYgTCAzNyAxMjQgTCA0MyAxMjAgTCA1NCAxMTYgTCA2OCAxMTUgTCA2OSA5OCBMIDcyIDg4IEwgODAgNzQgTCA5NCA2MSBMIDEwOCA1NSBMIDEyNSA1NCBMIDEzNiA1NyBMIDE1MSA2NSBMIDE2MiA0NiBMIDE3NSAzMyBMIDE5MCAyNCBMIDIwNCAyMCBMIDIyMiAyMCBMIDIyMyAyMSBMIDIyNyAyMSBMIDIzNiAyNCBMIDI0NiAzMCBMIDI3NCAzMCBaIE0gNjEzIDc4IEwgNjEzIDE2NSBMIDYzMSAxNjUgTCA2MzEgMTQxIEwgNjMyIDE0MCBMIDY1MSAxNDAgTCA2NzAgMTY1IEwgNjkyIDE2NSBMIDY3MCAxMzggTCA2NzAgMTM2IEwgNjc1IDEzMyBMIDY4MyAxMjMgTCA2ODYgMTEyIEwgNjg1IDEwMCBMIDY4MyA5NCBMIDY3OSA4OCBMIDY3MyA4MyBMIDY2NyA4MCBMIDY1OSA3OCBaIE0gNzA0IDc4IEwgNzA0IDE2NSBMIDcyMSAxNjUgTCA3MjEgMTEwIEwgNzIyIDEwOSBMIDczMSAxMTcgTCA3NTAgMTM5IEwgNzUzIDEzOSBMIDc3MyAxMTYgTCA3ODEgMTA5IEwgNzgyIDExMCBMIDc4MiAxNjUgTCA3OTkgMTY1IEwgNzk5IDc4IEwgNzg0IDc4IEwgNzUyIDExNiBMIDc0OSAxMTQgTCA3MTkgNzggWiBNIDk5OSA3NyBMIDk4NSA4MiBMIDk3NCA5MyBMIDk3MSA5OSBMIDk2NyAxMTQgTCA5NjcgMTM2IEwgOTcwIDE0NyBMIDk3MyAxNTMgTCA5ODIgMTYyIEwgOTkyIDE2NiBMIDEwMTEgMTY2IEwgMTAyMiAxNjIgTCAxMDMyIDE1MiBMIDEwMzQgMTQ4IEwgMTAzNSAxMzggTCAxMDM2IDEzNyBMIDEwMzQgMTI0IEwgMTAzMiAxMjAgTCAxMDI1IDExMyBMIDEwMTcgMTA5IEwgMTAxMyAxMDggTCA5OTggMTA4IEwgOTg3IDExMyBMIDk4NSAxMTIgTCA5ODUgMTA5IEwgOTg4IDEwMiBMIDk5NCA5NiBMIDEwMDMgOTIgTCAxMDE3IDkyIEwgMTAyOSA5NiBMIDEwMzAgODEgTCAxMDE4IDc3IFogTSAyNTUgNzkgTCAyNjggNzkgTCAzMTggMTM4IEwgMzE4IDgwIEwgMzE5IDc5IEwgMzM1IDc5IEwgMzM2IDgwIEwgMzM2IDE2NCBMIDMzNSAxNjUgTCAzMjAgMTY1IEwgMjcxIDEwNyBMIDI3MSAxNjQgTCAyNzAgMTY1IEwgMjU1IDE2NSBMIDI1NCAxNjQgTCAyNTQgODAgWiBNIDgzOCA3NyBMIDgyOCA4MCBMIDgyMyA4MyBMIDgxOCA4OCBMIDgxNCA5NyBMIDgxNCAxMDkgTCA4MTcgMTE2IEwgODIzIDEyMiBMIDgyOSAxMjUgTCA4NDUgMTI5IEwgODQ5IDEzMSBMIDg1MiAxMzEgTCA4NTYgMTMzIEwgODYwIDEzNyBMIDg2MSAxNDMgTCA4NTcgMTQ4IEwgODUwIDE1MSBMIDgzMSAxNTAgTCA4MTUgMTQ1IEwgODE0IDE2MCBMIDgyMyAxNjQgTCA4MjcgMTY0IEwgODMzIDE2NiBMIDg1NiAxNjYgTCA4NjggMTYxIEwgODc2IDE1MyBMIDg3OSAxNDUgTCA4NzkgMTM0IEwgODc2IDEyNyBMIDg3MSAxMjIgTCA4NjEgMTE3IEwgODQ4IDExNCBMIDgzNSAxMDkgTCA4MzIgMTA1IEwgODMyIDk5IEwgODM3IDk0IEwgODQzIDkyIEwgODYwIDkzIEwgODcwIDk2IEwgODczIDk4IEwgODc1IDgyIEwgODU3IDc3IFogTSA4OTUgNzggTCA4OTUgOTMgTCA5MjYgOTMgTCA5MjcgOTQgTCA5MDcgMTE1IEwgOTA3IDEyOCBMIDkxNCAxMjYgTCA5MjIgMTI2IEwgOTMwIDEyOCBMIDkzNyAxMzQgTCA5MzggMTQyIEwgOTMyIDE0OSBMIDkyNyAxNTEgTCA5MTAgMTUxIEwgODk5IDE0OCBMIDg5MyAxNDUgTCA4OTEgMTYwIEwgODk5IDE2NCBMIDkwNyAxNjYgTCA5MTYgMTY2IEwgOTE3IDE2NyBMIDkzMiAxNjYgTCA5NDUgMTYxIEwgOTUxIDE1NiBMIDk1NSAxNDkgTCA5NTYgMTMzIEwgOTUzIDEyNiBMIDk0MyAxMTcgTCA5MzEgMTE0IEwgOTMwIDExMiBMIDk1MSA5MiBMIDk1MSA3OCBaIE0gMTA1MyA3OCBMIDEwNDkgMTE2IEwgMTA0OCAxMTcgTCAxMDQ4IDEyNCBMIDEwNTAgMTI2IEwgMTA1NyAxMjQgTCAxMDY1IDEyNCBMIDEwNjYgMTIzIEwgMTA4MCAxMjUgTCAxMDg1IDEyOCBMIDEwODggMTMyIEwgMTA4OSAxNDEgTCAxMDg0IDE0OCBMIDEwNzcgMTUxIEwgMTA2MiAxNTEgTCAxMDQ3IDE0NiBMIDEwNDYgMTQ3IEwgMTA0NCAxNjEgTCAxMDU1IDE2NSBMIDEwNzEgMTY2IEwgMTA3MiAxNjcgTCAxMDczIDE2NiBMIDEwODMgMTY2IEwgMTA5MCAxNjQgTCAxMTAwIDE1OCBMIDExMDUgMTUxIEwgMTEwNiAxNDggTCAxMTA2IDEyNyBMIDExMDMgMTIxIEwgMTA5OCAxMTYgTCAxMDkzIDExMyBMIDEwODQgMTEwIEwgMTA2NiAxMTAgTCAxMDY1IDEwOSBMIDEwNjYgOTYgTCAxMDY4IDkzIEwgMTEwMyA5MyBMIDExMDMgNzggWiBNIDQ2OCA3NSBMIDQ2OCAxNjUgTCA0ODUgMTY1IEwgNDg1IDEyNyBMIDQ4OCAxMjIgTCA0OTQgMTE4IEwgNTAzIDExOCBMIDUxMCAxMjUgTCA1MTEgMTI4IEwgNTExIDE2NSBMIDUyNyAxNjUgTCA1MjcgMTE5IEwgNTI0IDExMiBMIDUxOCAxMDYgTCA1MTIgMTAzIEwgNTA4IDEwMyBMIDUwNyAxMDIgTCA0OTUgMTAzIEwgNDg2IDEwOCBMIDQ4NSAxMDcgTCA0ODUgNzUgWiBNIDU1MSAxMDggTCA1NDMgMTE3IEwgNTM5IDEyOCBMIDUzOSAxNDAgTCA1NDAgMTQxIEwgNTQwIDE0NSBMIDU0NCAxNTMgTCA1NTQgMTYyIEwgNTY1IDE2NiBMIDU4NSAxNjYgTCA1OTggMTYxIEwgNTk2IDE0NyBMIDU4MSAxNTIgTCA1NzAgMTUyIEwgNTYyIDE0OSBMIDU1NiAxNDIgTCA1NTcgMTM5IEwgNjAwIDEzOSBMIDYwMCAxMzUgTCA2MDEgMTM0IEwgNjAwIDEyMyBMIDU5NiAxMTQgTCA1ODcgMTA2IEwgNTgwIDEwMyBMIDU3NSAxMDMgTCA1NzQgMTAyIEwgNTY3IDEwMiBMIDU2NiAxMDMgTCA1NTggMTA0IFogTSA0MjMgMTA0IEwgNDE1IDEwOCBMIDQwNyAxMTYgTCA0MDQgMTIyIEwgNDAyIDEzNSBMIDQwMyAxMzYgTCA0MDMgMTQzIEwgNDA3IDE1MiBMIDQxMyAxNTkgTCA0MTkgMTYzIEwgNDI4IDE2NiBMIDQ0NiAxNjYgTCA0NTYgMTYzIEwgNDU3IDE2MiBMIDQ1NyAxNTcgTCA0NTYgMTU2IEwgNDU1IDE0NyBMIDQ0NSAxNTEgTCA0MzMgMTUxIEwgNDI2IDE0OCBMIDQyMiAxNDQgTCA0MTkgMTM4IEwgNDE5IDEzMSBMIDQyMSAxMjYgTCA0MjkgMTE5IEwgNDQxIDExNyBMIDQ0MiAxMTggTCA0NTEgMTE5IEwgNDU1IDEyMSBMIDQ1NiAxMDYgTCA0NDggMTAzIEwgNDQyIDEwMyBMIDQ0MSAxMDIgTCA0MzMgMTAyIEwgNDMyIDEwMyBaIE0gNjMxIDk0IEwgNjMyIDkzIEwgNjU1IDkzIEwgNjYwIDk1IEwgNjY0IDk4IEwgNjY4IDEwNiBMIDY2NyAxMTUgTCA2NjEgMTIyIEwgNjUzIDEyNSBMIDYzMiAxMjUgTCA2MzEgMTI0IFogTSAzNzQgMTA0IEwgMzc0IDE2NSBMIDM5MCAxNjUgTCAzOTAgMTA0IFogTSA5OTcgMTIyIEwgMTAwNyAxMjIgTCAxMDEwIDEyMyBMIDEwMTcgMTMwIEwgMTAxOCAxMzMgTCAxMDE3IDE0MyBMIDEwMTMgMTQ4IEwgMTAwOCAxNTEgTCAxMDA0IDE1MiBMIDk5NiAxNTEgTCA5ODggMTQ0IEwgOTg2IDE0MCBMIDk4NiAxMzMgTCA5ODggMTI5IEwgOTkzIDEyNCBaIE0gMzc3IDc1IEwgMzczIDgwIEwgMzczIDg4IEwgMzc0IDkwIEwgMzc4IDkzIEwgMzg2IDkzIEwgMzkxIDg5IEwgMzkyIDg1IEwgMzkxIDc5IEwgMzg3IDc1IEwgMzg0IDc0IFogTSA1NTYgMTI2IEwgNTYxIDExOSBMIDU2OCAxMTYgTCA1NzMgMTE2IEwgNTc5IDExOCBMIDU4MyAxMjIgTCA1ODUgMTI3IEwgNTg0IDEyOCBMIDU1NyAxMjggWiIgZmlsbD0iI0ZGRkZGRiIgZmlsbC1ydWxlPSJldmVub2RkIi8+Cjwvc3ZnPg=="/>
<div class="wrap">
<div class="scene">
<div class="world">
<div class="orbit">
<!-- SVG spokes behind cards -->
<svg class="spoke-svg" id="spokeSVG"></svg>
<!-- Curved dotted ring -->
<svg class="ring-svg" id="ringSVG"></svg>
<!-- Cards only -->
<div class="cards-ring" id="cardsRing"></div>
</div>
<div class="hub">
<button class="hubbtn" id="hubbtn" type="button"><img alt="NicheRMS365" class="hub-logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjUiIGhlaWdodD0iMjI2IiB2aWV3Qm94PSIwIDAgMzY1IDIyNiI+CiAgPHBhdGggZD0iTSAyMjIgNDMgTCAyMTcgNDkgTCAyMTcgMTgxIEwgMjE4IDE4MyBMIDIyMyAxODcgTCAzNTMgMTg3IEwgMzU4IDE4MSBMIDM1OCA0OSBMIDM1NiA0NSBMIDM1MCA0MiBMIDIyNSA0MiBaIE0gMjc0IDI5IEwgMjYwIDE2IEwgMjQ0IDcgTCAyMjYgMiBMIDIxOCAyIEwgMjE3IDAgTCAyMTAgMCBMIDIwOSAyIEwgMjAwIDIgTCAxOTkgMyBMIDE5MSA0IEwgMTc0IDExIEwgMTYxIDIwIEwgMTUwIDMxIEwgMTQzIDQwIEwgMTI5IDM2IEwgMTA5IDM2IEwgOTcgMzkgTCA4NiA0NCBMIDc2IDUxIEwgNjcgNjAgTCA2MCA3MCBMIDU0IDgzIEwgNTEgOTcgTCA0OSA5OSBMIDQ2IDk5IEwgMzUgMTAzIEwgMjMgMTExIEwgMTMgMTIyIEwgNiAxMzQgTCAyIDE0NiBMIDIgMTUxIEwgMCAxNTIgTCAwIDE3MiBMIDIgMTczIEwgMiAxNzcgTCA1IDE4NyBMIDExIDE5OSBMIDE5IDIwOSBMIDI2IDIxNSBMIDQwIDIyMyBMIDQ3IDIyNSBMIDI5NyAyMjUgTCAzMDYgMjIyIEwgMzE1IDIxNyBMIDMyOSAyMDQgTCAzMzEgMjAwIEwgMzA2IDIwMCBMIDI5NiAyMDYgTCAyODkgMjA4IEwgNTUgMjA4IEwgNDggMjA2IEwgMzYgMTk5IEwgMjUgMTg2IEwgMjAgMTczIEwgMTkgMTU2IEwgMjIgMTQ0IEwgMjYgMTM2IEwgMzcgMTI0IEwgNDMgMTIwIEwgNTQgMTE2IEwgNjggMTE1IEwgNjkgOTggTCA3MiA4OCBMIDgwIDc0IEwgOTQgNjEgTCAxMDggNTUgTCAxMjUgNTQgTCAxMzYgNTcgTCAxNTEgNjUgTCAxNjIgNDYgTCAxNzUgMzMgTCAxOTAgMjQgTCAyMDQgMjAgTCAyMjIgMjAgTCAyMjMgMjEgTCAyMjcgMjEgTCAyMzYgMjQgTCAyNDYgMzAgTCAyNzQgMzAgWiBNIDI1NSA3OSBMIDI2OCA3OSBMIDMxOCAxMzggTCAzMTggODAgTCAzMTkgNzkgTCAzMzUgNzkgTCAzMzYgODAgTCAzMzYgMTY0IEwgMzM1IDE2NSBMIDMyMCAxNjUgTCAyNzEgMTA3IEwgMjcxIDE2NCBMIDI3MCAxNjUgTCAyNTUgMTY1IEwgMjU0IDE2NCBMIDI1NCA4MCBaIiBmaWxsPSIjRkZGRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz4KPC9zdmc+"/></button>
</div>
</div>
</div></div>

<div class="module-modal" id="moduleModal"> <div class="module-backdrop" id="mmBackdrop"></div> <div aria-labelledby="mmTitle" aria-modal="true" class="module-card" role="dialog"> <button aria-label="Close" class="module-close" id="mmClose">✕</button> <div class="module-head"> <div class="module-ico" id="mmIcon"></div> <h2 class="module-title" id="mmTitle">Title</h2> </div> <div class="module-grid" id="mmGrid"></div> </div></div>
<div class="controls">
<button aria-label="Previous" class="btn" id="prev"><svg viewbox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></button>
<div class="progress"><div class="bar" id="bar"></div></div>
<button aria-label="Next" class="btn" id="next"><svg viewbox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"></path></svg></button>
</div>

<script>
const modules = [
  { title: "General Incident Management", svg: `<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16.47 20.59">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" x="0" width="16.47" height="20.59"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M8.24,18.43c1.78-.57,3.26-1.7,4.43-3.4,1.17-1.7,1.75-3.59,1.75-5.66v-4.86l-6.18-2.32-6.18,2.32v4.86c0,2.08.58,3.96,1.75,5.66,1.17,1.7,2.64,2.83,4.43,3.4M8.24,20.59c-2.39-.6-4.35-1.97-5.91-4.11C.78,14.35,0,11.98,0,9.37V3.09L8.24,0l8.24,3.09v6.28c0,2.61-.78,4.98-2.33,7.12-1.55,2.14-3.52,3.5-5.91,4.11"/>
  </g>
</svg>` },
  { title: "Custody Management", svg: `<svg class="padded" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 21.1 20.07">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" x="0" y="0" width="21.1" height="20.07"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M0,16.47v-2.86c0-.58.15-1.12.44-1.62.29-.5.69-.88,1.21-1.13.88-.45,1.86-.82,2.96-1.13s2.32-.46,3.65-.46c-.21.31-.38.64-.53.99-.15.35-.26.72-.35,1.09-1.03.09-1.95.26-2.75.53-.81.27-1.48.54-2.03.84-.17.09-.3.21-.4.37-.1.16-.14.34-.14.53v.8h5.33c.08.38.2.74.35,1.08s.32.67.53.98H0ZM13.9,15.44c.72,0,1.33-.25,1.83-.75.5-.5.75-1.11.75-1.83s-.25-1.33-.75-1.83c-.5-.5-1.11-.75-1.83-.75s-1.33.25-1.83.75-.75,1.11-.75,1.83.25,1.33.75,1.83,1.11.75,1.83.75M19.66,20.07l-3.29-3.3c-.36.21-.75.38-1.16.52-.41.14-.85.21-1.31.21-1.29,0-2.38-.45-3.28-1.35-.9-.9-1.35-1.99-1.35-3.28s.45-2.38,1.35-3.28c.9-.9,1.99-1.35,3.28-1.35s2.38.45,3.28,1.35c.9.9,1.35,1.99,1.35,3.28,0,.46-.07.9-.21,1.31-.14.41-.31.8-.51,1.16l3.29,3.29-1.44,1.44ZM8.24,6.18c.57,0,1.05-.2,1.45-.6.4-.4.61-.89.61-1.45s-.2-1.05-.61-1.45-.89-.6-1.45-.6-1.05.2-1.45.6c-.4.4-.61.89-.61,1.45s.2,1.05.61,1.45c.4.4.89.6,1.45.6M8.24,8.24c-1.13,0-2.1-.4-2.91-1.21-.81-.81-1.21-1.77-1.21-2.91s.4-2.1,1.21-2.91c.81-.81,1.78-1.21,2.91-1.21s2.1.4,2.91,1.21c.81.81,1.21,1.78,1.21,2.91s-.4,2.1-1.21,2.91c-.81.81-1.78,1.21-2.91,1.21"/>
  </g>
</svg>` },
  { title: "Case Preparation and Criminal Justice", svg: `<?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.53 19.56">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }
    </style>
  </defs>
  <path class="cls-1" d="M0,19.56h12.35v-2.06H0v2.06ZM0,8.75l5.82,5.82,2.21-2.21L2.16,6.54l-2.16,2.21ZM3.66,5.1l13.43,13.43,1.44-1.44L5.1,3.66l-1.44,1.44ZM8.75,0l-2.21,2.16,5.82,5.87,2.21-2.21L8.75,0Z"/>
</svg>` },
  { title: "Property Management", svg: `<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.47 18.53">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }
    </style>
  </defs>
  <path class="cls-1" d="M2.06,7.21l6.18-4.63,6.18,4.63v9.27h-3.09v-6.18h-6.18v6.18h-3.09V7.21ZM8.24,0L0,6.18v12.35h7.21v-6.18h2.06v6.18h7.2V6.18L8.24,0Z"/>
</svg>` },
  { title: "Vulnerability Management", svg: `<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20.59 17.5">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" x="0" y="0" width="20.59" height="17.5"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M8.24,7.21c.57,0,1.05-.2,1.45-.61s.6-.89.6-1.45-.2-1.05-.6-1.45c-.4-.4-.89-.6-1.45-.6s-1.05.2-1.45.6c-.4.4-.61.89-.61,1.45s.2,1.05.61,1.45.89.61,1.45.61M2.06,15.44h12.35v-.82c0-.19-.05-.36-.14-.51-.09-.16-.22-.28-.37-.36-.93-.46-1.86-.81-2.8-1.04-.94-.23-1.9-.35-2.86-.35s-1.91.12-2.86.35c-.94.23-1.88.58-2.81,1.04-.15.09-.28.2-.37.36-.09.15-.14.33-.14.51v.82ZM0,17.5v-2.88c0-.58.15-1.12.45-1.61.3-.49.7-.86,1.2-1.12,1.06-.53,2.14-.93,3.24-1.2,1.1-.27,2.21-.4,3.35-.4s2.25.13,3.35.4c1.1.27,2.18.66,3.24,1.2.5.26.9.63,1.2,1.12.3.49.45,1.02.45,1.61v2.88H0ZM8.24,9.26c-1.13,0-2.1-.4-2.91-1.21-.81-.81-1.21-1.78-1.21-2.91s.4-2.1,1.21-2.91c.81-.81,1.78-1.21,2.91-1.21s2.1.4,2.91,1.21c.81.81,1.21,1.78,1.21,2.91s-.4,2.1-1.21,2.91-1.78,1.21-2.91,1.21M18.53,0h2.06v5.15h-2.06V0ZM19.56,8.24c-.29,0-.54-.1-.73-.3-.2-.2-.3-.44-.3-.73s.1-.54.3-.73c.2-.2.44-.3.73-.3s.54.1.73.3c.2.2.3.44.3.73s-.1.54-.3.73c-.2.2-.44.3-.73.3"/>
  </g>
</svg>` },
  { title: "Investigation and Crime Management", svg: `<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20.59 18.53">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" width="20.59" height="18.53"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M2.06,18.53c-.57,0-1.05-.2-1.45-.61-.4-.4-.61-.89-.61-1.45v-2.06c0-.57.2-1.05.61-1.45.4-.4.89-.61,1.45-.61h1.03v-5.15c0-2.01.7-3.71,2.1-5.11,1.4-1.4,3.1-2.1,5.11-2.1s3.71.7,5.11,2.1c1.4,1.4,2.1,3.1,2.1,5.11v5.15h1.03c.57,0,1.05.2,1.45.61s.61.89.61,1.45v2.06c0,.57-.2,1.05-.61,1.45-.4.4-.89.61-1.45.61H2.06ZM5.15,12.35h10.3v-5.15c0-1.42-.5-2.64-1.51-3.64-1-1-2.22-1.51-3.64-1.51s-2.64.5-3.64,1.51c-1,1-1.51,2.22-1.51,3.64v5.15ZM6.18,10.29h2.06v-3.09c0-.57.2-1.05.6-1.45.4-.4.89-.61,1.45-.61v-2.06c-1.13,0-2.1.4-2.91,1.21-.81.81-1.21,1.78-1.21,2.91v3.09ZM2.06,16.47h16.47v-2.06H2.06v2.06Z"/>
  </g>
</svg>` },
  { title: "Forensics Management", svg: `<?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 18.53 18.53">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" x="0" width="18.53" height="18.53"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M6.69,11.32c1.29,0,2.38-.45,3.28-1.35.9-.9,1.35-1.99,1.35-3.28s-.45-2.38-1.35-3.28-1.99-1.35-3.28-1.35-2.38.45-3.28,1.35-1.35,1.99-1.35,3.28.45,2.38,1.35,3.28c.9.9,1.99,1.35,3.28,1.35M17.09,18.53l-6.49-6.49c-.51.41-1.11.74-1.77.98-.67.24-1.38.36-2.14.36-1.87,0-3.45-.65-4.75-1.94-1.3-1.3-1.94-2.88-1.94-4.75S.65,3.24,1.94,1.94C3.24.65,4.82,0,6.69,0s3.45.65,4.75,1.94,1.94,2.88,1.94,4.75c0,.76-.12,1.47-.36,2.14-.24.67-.57,1.26-.98,1.78l6.49,6.49-1.44,1.44Z"/>
  </g>
</svg>` },
  { title: "Intelligence Management", svg: `<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16.47 17.5">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
      }

      .cls-2 {
        fill: none;
      }

      .cls-3 {
        clip-path: url(#clippath);
      }
    </style>
    <clipPath id="clippath">
      <rect class="cls-2" width="16.47" height="17.5"/>
    </clipPath>
  </defs>
  <g class="cls-3">
    <path class="cls-1" d="M8.28,11.81c.79,0,1.47-.3,2.03-.9.56-.6.84-1.32.84-2.16s-.28-1.57-.84-2.17c-.56-.6-1.24-.9-2.03-.9s-1.48.3-2.04.9c-.55.6-.83,1.32-.83,2.17s.28,1.57.83,2.16c.55.6,1.23.9,2.04.9M7.42,15.75h1.62l.29-2.32c.42-.12.82-.29,1.18-.51.36-.23.69-.5.99-.82l2.03.9.8-1.49-1.76-1.42c.07-.2.12-.42.14-.64.03-.23.04-.46.04-.69s-.01-.46-.04-.69c-.03-.23-.08-.44-.14-.65l1.76-1.42-.8-1.49-2.03.92c-.3-.34-.63-.62-.99-.84-.36-.23-.75-.4-1.18-.51l-.27-2.32h-1.62l-.29,2.32c-.42.12-.82.29-1.18.51s-.69.5-.99.82l-2.03-.9-.8,1.49,1.76,1.4c-.07.22-.12.44-.14.66-.03.22-.04.45-.04.7,0,.23.01.46.04.68.03.22.08.44.14.66l-1.76,1.42.8,1.49,2.03-.92c.3.34.63.62.99.84.36.23.75.4,1.18.51l.27,2.32ZM5.98,17.5l-.33-2.8c-.18-.07-.35-.16-.5-.26-.16-.1-.31-.21-.46-.33l-2.44,1.09L0,11.05l2.11-1.71c-.01-.1-.02-.2-.02-.3v-.59c0-.09,0-.19.02-.3L0,6.45,2.25,2.3l2.44,1.09c.15-.12.31-.23.47-.33.16-.1.33-.19.49-.26l.33-2.8h4.51l.33,2.8c.18.07.35.16.5.26.16.1.31.21.46.33l2.44-1.09,2.25,4.16-2.11,1.71c.01.1.02.2.02.3v.59c0,.1-.01.19-.04.3l2.11,1.71-2.25,4.16-2.42-1.09c-.15.12-.31.23-.47.33-.16.1-.33.19-.49.26l-.33,2.8h-4.51Z"/>
  </g>
</svg>` }
];

const cs = getComputedStyle(document.documentElement);
const cfg = {
  radius: parseFloat(cs.getPropertyValue('--radius')),
  tiltDeg: parseFloat(cs.getPropertyValue('--tilt')) || -35,             // visual shaping only
  follow:  parseFloat(cs.getPropertyValue('--card-tilt-follow')) || .6,  // vertical follow fraction
  minScale: parseFloat(cs.getPropertyValue('--min-scale')) || .72,
  maxBlur:  parseFloat(cs.getPropertyValue('--max-blur')) || 6,
  minOpacity: parseFloat(cs.getPropertyValue('--min-opacity')) || .6,
  spokeWidth: parseFloat(cs.getPropertyValue('--spoke-width')) || 2.5,
  spokeColor: cs.getPropertyValue('--spoke-color').trim() || '#d9f4ff55',
  spokeDot: parseFloat(cs.getPropertyValue('--spoke-dot')) || 6,
  spokeGap: parseFloat(cs.getPropertyValue('--spoke-gap')) || 10,
  spokeStartGap: parseFloat(cs.getPropertyValue('--spoke-start-gap')) || 0,
  spokeEndGap: parseFloat(cs.getPropertyValue('--spoke-end-gap')) || 18
};
cfg.tiltRad = cfg.tiltDeg * Math.PI/180;

let angle = 0, targetAngle = 0;
const step = 360 / modules.length;
let animId = null;

const cardsRing = document.getElementById('cardsRing');
const bar = document.getElementById('bar');
const svg = document.getElementById('spokeSVG');
const ringSvg = document.getElementById('ringSVG');

// Build cards
const items = modules.map((m,i)=>{
  const node = document.createElement('div');
  node.className = 'node';
  node.dataset.baseAngle = i * step;

  const card = document.createElement('button');
  card.className = 'card'; card.type = 'button';
  card.setAttribute('aria-label', m.title);
  card.innerHTML = `<div class="ico">${m.svg ? m.svg : (m.icon || "")}</div><h3>${m.title}</h3>`;

  node.appendChild(card);
  cardsRing.appendChild(node);
  return {node, card, index:i};
});
// /* GIM line-break patch */ Force multi-line title only for "General Incident Management"
try{
  items.forEach(({card}, idx)=>{
    const h3 = card.querySelector('h3');
    if(h3 && h3.textContent.trim() === "General Incident Management"){
      h3.innerHTML = "General<br>Incident<br>Management";
    }
  });
}catch(e){}


document.getElementById('next').addEventListener('click', ()=>{ targetAngle -= step; tweenTo(targetAngle); });
document.getElementById('prev').addEventListener('click', ()=>{ targetAngle += step; tweenTo(targetAngle); });
window.addEventListener('resize', ()=>{ render(); });

function tweenTo(dest){
  cancelAnimationFrame(animId);
  const start = angle;
  const delta = ((dest - start + 540) % 360) - 180;
  const dur = parseFloat(cs.getPropertyValue('--duration')) || 620;
  const t0 = performance.now();
  (function tick(now){
    const t = Math.min(1, (now - t0)/dur);
    const ease = t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;
    angle = start + delta * ease;
    render();
    if (t < 1) animId = requestAnimationFrame(tick);
    else { angle = dest; render(); }
  })(performance.now());
}

function render(){
  cardsRing.style.transform = `rotateY(${angle}deg)`;

  const progress = ((-angle % 360) + 360) % 360 / 360;
  bar.style.width = `${progress*100}%`;

  // Position nodes
  items.forEach(({node, card})=>{
    const base = parseFloat(node.dataset.baseAngle);
    const local = base + angle;
    const rad = local * Math.PI/180;

    const z0 = Math.cos(rad) * cfg.radius;                 // base depth
    const yOffset = -Math.sin(cfg.tiltRad) * z0 * cfg.follow; // vertical follow
    const zWorld  =  Math.cos(cfg.tiltRad) * z0;           // depth for scale/blur

    const zRange = cfg.radius * Math.cos(cfg.tiltRad);
    const zNorm  = (zWorld + zRange) / (2*zRange);
    const scale  = cfg.minScale + (1-cfg.minScale)*zNorm;
    const opacity= cfg.minOpacity + (1-cfg.minOpacity)*zNorm;
    const blur   = (1 - zNorm) * cfg.maxBlur;

    node.style.transform = `rotateY(${base}deg) translateZ(${cfg.radius}px) translateY(${yOffset}px)`;
    node.style.zIndex = Math.round(zWorld);
    card.style.transform = `translate(-50%, -50%) rotateY(${-local}deg) scale(${scale})`;
    card.style.opacity = opacity.toFixed(3);
    card.style.filter = `blur(${blur.toFixed(2)}px)`;
  });

  // Draw dotted spokes using SVG in screen space
  drawSpokes();
  drawCurves();
}

function drawSpokes(){
  // Size the SVG to match the orbit box
  const orbit = document.querySelector('.orbit');
  const ob = orbit.getBoundingClientRect();
  svg.setAttribute('width', ob.width);
  svg.setAttribute('height', ob.height);
  svg.setAttribute('viewBox', `0 0 ${ob.width} ${ob.height}`);

  // Compute center (hub) in SVG coords
  const cx = ob.width / 2;
  const cy = ob.height / 2;

  // Build/Update one line per item
  // Recreate each time for simplicity and correctness (8 items)
  svg.innerHTML = "";
  
  let gidCount = 0; // for unique gradient ids
items.forEach(({card})=>{
    const r = card.getBoundingClientRect();
    const tx = r.left + r.width/2 - ob.left;  // target (card center)
    const ty = r.top  + r.height/2 - ob.top;

    let dx = tx - cx, dy = ty - cy;
    const dist = Math.hypot(dx, dy) || 1;
    // Unit vector from center to card
    const ux = dx / dist, uy = dy / dist;

    // Apply start/end gaps
    const x1 = cx + ux * cfg.spokeStartGap;
    const y1 = cy + uy * cfg.spokeStartGap;
    const x2 = cx + ux * Math.max(0, dist - cfg.spokeEndGap);
    const y2 = cy + uy * Math.max(0, dist - cfg.spokeEndGap);

    // Ensure a <defs> exists
    let defs = svg.querySelector('defs');
    if(!defs){
      defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
      svg.appendChild(defs);
    }
    // Build a gradient that fades near the end (toward the card)
    const gid = 'spokeGrad' + (gidCount++);
    const grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    grad.setAttribute('id', gid);
    grad.setAttribute('gradientUnits', 'userSpaceOnUse');
    grad.setAttribute('x1', x1);
    grad.setAttribute('y1', y1);
    grad.setAttribute('x2', x2);
    grad.setAttribute('y2', y2);
    const len = Math.hypot(x2 - x1, y2 - y1);
    const fade = 95; // px length to fade near the card
    const stopPos = Math.max(0, Math.min(1, 1 - (fade / (len || 1))));
    const s0 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    s0.setAttribute('offset', '0%');
    s0.setAttribute('stop-color', cfg.spokeColor);
    s0.setAttribute('stop-opacity', '1');
    const s1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    s1.setAttribute('offset', (stopPos*100).toFixed(1) + '%');
    s1.setAttribute('stop-color', cfg.spokeColor);
    s1.setAttribute('stop-opacity', '1');
    const s2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    s2.setAttribute('offset', '100%');
    s2.setAttribute('stop-color', cfg.spokeColor);
    s2.setAttribute('stop-opacity', '0');
    grad.appendChild(s0); grad.appendChild(s1); grad.appendChild(s2);
    defs.appendChild(grad);

    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', x1);
    line.setAttribute('y1', y1);
    line.setAttribute('x2', x2);
    line.setAttribute('y2', y2);
    line.setAttribute('stroke', `url(#${gid})`);
    line.setAttribute('stroke-width', cfg.spokeWidth);
    line.setAttribute('stroke-linecap', 'round');
    line.setAttribute('stroke-dasharray', `${cfg.spokeDot} ${cfg.spokeGap}`);
    svg.appendChild(line);
  });
}

render();


function drawCurves(){
  // Size to orbit box
  const orbit = document.querySelector('.orbit');
  const ob = orbit.getBoundingClientRect();
  ringSvg.setAttribute('width', ob.width);
  ringSvg.setAttribute('height', ob.height);
  ringSvg.setAttribute('viewBox', `0 0 ${ob.width} ${ob.height}`);

  // Center for curvature
  const cx = ob.width / 2;
  const cy = ob.height / 2;

  // Rebuild
  ringSvg.innerHTML = "";

  
  
  // Gradient defs for fading curve ends (additive)
  let rgidCount = 0;
  const rdefs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
  ringSvg.appendChild(rdefs);
// Identify ONLY the two back-most arcs by midpoint Y (smallest Y => farthest/back)
  const centers = items.map(it => centerOf(it.card));
  const mids = [];
  for(let i=0;i<items.length;i++){
    const a = centers[i], b = centers[(i+1)%items.length];
    const my = (a.y + b.y)/2;
    mids.push({ i, my });
  }
  mids.sort((p,q)=> p.my - q.my);
  const backSet = new Set(mids.slice(0,2).map(o=>o.i));
// Helper: center of a card
  function centerOf(card){
    const r = card.getBoundingClientRect();
    return { x: r.left + r.width/2 - ob.left, y: r.top + r.height/2 - ob.top };
  }

  // Build curved dotted paths connecting adjacent cards
  for(let i=0;i<items.length;i++){
    const a = centerOf(items[i].card);
    const b = centerOf(items[(i+1)%items.length].card);
    // Outward control point for gentle arc
    const mx = (a.x + b.x)/2, my = (a.y + b.y)/2;
    let nx = mx - cx, ny = my - cy;
    const nlen = Math.hypot(nx, ny) || 1;
    nx /= nlen; ny /= nlen;
    const d = Math.hypot(b.x - a.x, b.y - a.y);
    const bow = Math.min(120, Math.max(24, d * 0.18));
    const depthScale = backSet.has(i) ? 0.25 : 1;
    const cpx = mx + nx * bow * depthScale;
    const cpy = my + ny * bow * depthScale;

    
    // Build a gradient along the chord that fades near both card ends
    const rgid = 'ringGrad' + (rgidCount++);
    const grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    grad.setAttribute('id', rgid);
    grad.setAttribute('gradientUnits', 'userSpaceOnUse');
    grad.setAttribute('x1', a.x); grad.setAttribute('y1', a.y);
    grad.setAttribute('x2', b.x); grad.setAttribute('y2', b.y);
    const rlen = Math.hypot(b.x - a.x, b.y - a.y);
    const rfade = 285; // px (uses same fade distance as spokes)
    let s = Math.max(0, Math.min(1, (rfade / (rlen || 1)))); // start solid offset
    let e = Math.max(0, Math.min(1, 1 - (rfade / (rlen || 1)))); // end solid start
    if (s > e) { s = e = 0.5; } // clamp if extremely short

    const rS0 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    rS0.setAttribute('offset', '0%'); rS0.setAttribute('stop-color', cfg.spokeColor); rS0.setAttribute('stop-opacity', '0');
    const rS1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    rS1.setAttribute('offset', (s*100).toFixed(1) + '%'); rS1.setAttribute('stop-color', cfg.spokeColor); rS1.setAttribute('stop-opacity', '1');
    const rS2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    rS2.setAttribute('offset', (e*100).toFixed(1) + '%'); rS2.setAttribute('stop-color', cfg.spokeColor); rS2.setAttribute('stop-opacity', '1');
    const rS3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    rS3.setAttribute('offset', '100%'); rS3.setAttribute('stop-color', cfg.spokeColor); rS3.setAttribute('stop-opacity', '0');
    grad.appendChild(rS0); grad.appendChild(rS1); grad.appendChild(rS2); grad.appendChild(rS3);
    rdefs.appendChild(grad);

    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', `M ${a.x} ${a.y} Q ${cpx} ${cpy} ${b.x} ${b.y}`);
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke', `url(#${rgid})`);
    path.setAttribute('stroke-width', cfg.spokeWidth);
    path.setAttribute('stroke-linecap', 'round');
    path.setAttribute('stroke-dasharray', `${cfg.spokeDot} ${cfg.spokeGap}`);
    ringSvg.appendChild(path);
}
}
</script>
<script>

// --- Additive Menu Overlay (triggered by hubbtn) ---
const menuOverlay = document.getElementById('menuOverlay');
const menuList = document.getElementById('menuList');
const menuBackdrop = document.getElementById('menuBackdrop');
const menuClose = document.getElementById('menuClose');

function buildMenu(){
  if(!menuList || menuList.children.length) return;
  modules.forEach((m, i)=>{
    const li = document.createElement('li');
    li.className = 'menu-item';
    li.innerHTML = `<span class="ico">${m.svg ? m.svg : (m.icon || "")}</span><span>${m.title}</span>`;
    li.addEventListener('click', ()=>{
      // rotate to the selected module and close
      const base = i * step;
      targetAngle = -base;
      tweenTo(targetAngle);
      toggleMenu(false);
    });
    menuList.appendChild(li);
  });
}

function toggleMenu(force){
  if(!menuOverlay) return;
  const open = force !== undefined ? force : !menuOverlay.classList.contains('open');
  if(open){
    buildMenu();
    menuOverlay.classList.add('open');
  }else{
    menuOverlay.classList.remove('open');
  }
}

// Hook up triggers
const hubBtnEl = document.getElementById('hubbtn');
if(hubBtnEl){
  hubBtnEl.addEventListener('click', ()=> toggleMenu());
}
if(menuBackdrop){ menuBackdrop.addEventListener('click', ()=> toggleMenu(false)); }
if(menuClose){ menuClose.addEventListener('click', ()=> toggleMenu(false)); }
window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') toggleMenu(false); });


// --- Module modal that opens when a card is clicked (style-focused) ---
const mm = document.getElementById('moduleModal');
const mmBackdrop = document.getElementById('mmBackdrop');
const mmClose = document.getElementById('mmClose');
const mmTitle = document.getElementById('mmTitle');
const mmIcon  = document.getElementById('mmIcon');
const mmGrid  = document.getElementById('mmGrid');

// Example submenu content – can be replaced with real items per module
const defaultMenus = {
  "General Incident Management": [
    "Information Sharing Process","Intelligence submission","Tasking/ Disseminating Intelligence","Stop and search",
    "OCG Management","Crime Stoppers Automation","Intelligence Processing","ANPR"
  ]
};

function submenuFor(title){
  return defaultMenus[title] || ["Overview","Workflows","Reports","Integrations","Data Quality","Dashboards","APIs","Help"];
}

function openModuleModal(idx){
  const m = modules[idx];
  mmTitle.textContent = m.title;
  mmIcon.innerHTML = m.svg || (m.icon || "");
  mmGrid.innerHTML = "";
  submenuFor(m.title).forEach(label=>{
    const btn = document.createElement('button');
    btn.className = 'menu-pill';
    btn.textContent = label;
    btn.addEventListener('click', ()=>{
      // Placeholder action; close for now
      closeModuleModal();
    });
    mmGrid.appendChild(btn);
  });
  mm.classList.add('open');
}

function closeModuleModal(){ mm.classList.remove('open'); }

if(mmBackdrop) mmBackdrop.addEventListener('click', closeModuleModal);
if(mmClose) mmClose.addEventListener('click', closeModuleModal);
window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModuleModal(); });

// Attach click handlers to cards after they are created
items.forEach(({card}, idx)=>{
  card.style.cursor = 'pointer';
  card.addEventListener('click', (ev)=>{
    ev.stopPropagation();
    openModuleModal(idx);
  });
});

(function ensureSvgOverflowVisible(){
  function patch(){
    document.querySelectorAll('.ico svg').forEach(function(sv){
      try{
        sv.setAttribute('overflow','visible');
        sv.style.overflow = 'visible';
      }catch(e){}
    });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', patch);
  } else {
    patch();
  }
  // Run again after first render tick in case cards are injected late
  setTimeout(patch, 60);
})();
</script>
<script>
(function hardSizeSvgs(){
  function sizeAll(){
    var root = getComputedStyle(document.documentElement);
    var base = parseFloat(root.getPropertyValue('--icon-size')) || 64;
    var scale = parseFloat(root.getPropertyValue('--icon-scale')) || 0.10;
    var baseSize = base * scale;
    document.querySelectorAll('.ico svg').forEach(function(sv){
      var isPadded = sv.classList.contains('padded');
      var w = isPadded ? baseSize * 0.92 : baseSize;
      var h = isPadded ? baseSize * 0.92 : baseSize;
      sv.setAttribute('width', w.toFixed(2));
      sv.setAttribute('height', h.toFixed(2));
      sv.style.width = w.toFixed(2) + 'px';
      sv.style.height = h.toFixed(2) + 'px';
      sv.setAttribute('overflow','visible');
      sv.style.overflow = 'visible';
    });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', sizeAll);
  } else {
    sizeAll();
  }
  // Run once after a tick in case cards render late / on rotation
  setTimeout(sizeAll, 80);
  // Also adjust on window resize
  window.addEventListener('resize', sizeAll);
})();
</script>
<script>
(function fixIconClipping(){
  function patch(){
    document.querySelectorAll('.ico svg').forEach(function(sv){
      try{
        sv.setAttribute('overflow','visible');
        sv.style.overflow = 'visible';
        sv.style['overflow-clip-margin'] = 'content-box';
        // add 'padded' class for a subtle inset
        if(!sv.classList.contains('padded')) sv.classList.add('padded');
        // Remove clip-path attributes/styles which can crop strokes at edges
        sv.querySelectorAll('[clip-path]').forEach(function(el){ el.removeAttribute('clip-path'); });
        sv.querySelectorAll('style').forEach(function(st){
          try{
            st.textContent = st.textContent.replace(/clip-path\s*:\s*url\([^)]*\)\s*;?/g, 'clip-path:none;');
          }catch(e){}
        });
        // Remove <clipPath> defs entirely to prevent reapplication
        sv.querySelectorAll('clipPath').forEach(function(cp){ cp.parentNode && cp.parentNode.removeChild(cp); });
      }catch(e){}
    });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', patch);
  } else {
    patch();
  }
  // Also run after a tick and on resize (icons may re-render)
  setTimeout(patch, 100);
  window.addEventListener('resize', patch);
})();
</script>
</body>
</html>