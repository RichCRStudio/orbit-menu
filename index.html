<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>3D Orbit Menu ‚Äî Spacing +100px (Stable Clicks)</title>
<style>
  :root{
    --bg1:#072a44;
    --bg2:#0b4e68;
    --accent:#5fd0ff;
    /* Manually widened spacing: 420px ‚Üí 520px */
    --radius: 520px;
    --orbit-shift: 90px;    /* keep hub visible */
    --card-w: 210px;
    --card-h: 110px;
    --min-scale: .72;
    --max-blur: 6px;
    --min-opacity: .60;
    --perspective: 1200px;
    --duration: 620ms;
  }

  html,body{height:100%;margin:0}
  body{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
       background: radial-gradient(1200px 1200px at 70% 20%, var(--bg2), var(--bg1));
       color:#e8f7ff; overflow:hidden;}

  .wrap{ position:relative; height:100%; display:grid; place-items:center; user-select:none; transition: filter .3s ease, opacity .3s ease; }
  .scene{ position:relative; width:min(1200px, 96vw); height:min(720px, 75vh); perspective:var(--perspective); perspective-origin:50% 50%; overflow:visible; }
  .world{ position:absolute; inset:0; transform-style:preserve-3d; }
  .orbit{ position:absolute; inset:0; transform: translateY(var(--orbit-shift)); transform-style:preserve-3d; z-index:2; }
  .ring{ position:absolute; inset:0; transform-style:preserve-3d; }

  /* Clickable hub (doesn't block ring) */
  .hub{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); text-align:center; z-index:3; pointer-events:none; }
  .hubbtn{ background:none; border:none; cursor:pointer; color:inherit; padding:0; text-align:center; pointer-events:auto; }
  .hub .shield{ width:68px;height:68px;border-radius:18px; border:2px solid #9fe6ff33; display:grid;place-items:center; margin:0 auto 10px; box-shadow:0 0 40px #0ff2ff22 inset, 0 0 18px #0ff2ff33; }
  .hub .shield::before{ content:"‚òÅÔ∏è"; font-size:32px; filter:drop-shadow(0 0 6px #0ff); }
  .hub h1{ margin:4px 0 0; font-weight:800; letter-spacing:.6px; font-size: clamp(26px, 3.4vw, 48px); line-height:1.05; color:#eaf8ff; text-shadow:0 2px 16px #0009; }
  .hub small{ display:block; opacity:.8; letter-spacing:.2px; margin-top:2px }

  /* Node + Card */
  .node{ position:absolute; left:50%; top:50%; transform-style:preserve-3d; pointer-events:auto; will-change: transform; }
  .card{
    position:absolute; left:0; top:0; width:var(--card-w); height:var(--card-h);
    transform: translate(-50%, -50%) scale(1); transform-origin:center center;
    border-radius:18px; background: linear-gradient(180deg, #ffffff08, #071f30aa);
    border:1px solid #9fe6ff1c; box-shadow: 0 10px 30px #0007, 0 0 0 1px #ffffff10 inset;
    display:grid; grid-template-columns:64px 1fr; align-items:center; gap:14px; padding:14px 16px;
    backdrop-filter: blur(3px); will-change: transform, filter, opacity; cursor:pointer;
  }
  .card:focus-visible{ outline:2px solid #9fe6ff; outline-offset:3px }
  .ico{ width:56px;height:56px;border-radius:14px; display:grid;place-items:center; background:#0e3b54; border:1px solid #bdf2ff22; box-shadow:0 4px 20px #0008 inset; font-size:28px; }
  .card h3{ margin:0 0 4px; font-size:18px; font-weight:800; letter-spacing:.2px; }
  .card p{ margin:0; font-size:13px; opacity:.75; }

  /* Controls */
  .controls{ position:absolute; bottom:24px; left:50%; transform:translateX(-50%); display:flex; align-items:center; gap:16px; }
  .btn{ pointer-events:auto; width:46px;height:46px;border-radius:12px; background:#ffffff15; border:1px solid #9fe6ff2a; display:grid;place-items:center; cursor:pointer; transition:transform .15s ease, background .2s ease, box-shadow .2s ease; box-shadow:0 6px 18px #0007, 0 0 0 1px #ffffff10 inset; }
  .btn:hover{ transform:translateY(-1px); background:#ffffff22 } .btn:active{ transform:translateY(0) scale(.98) }
  .btn svg{ width:22px;height:22px; fill:#bff1ff }
  .progress{ width:360px;height:4px;border-radius:99px;background:#ffffff14; overflow:hidden; }
  .progress .bar{ height:100%; width:0%; background: linear-gradient(90deg, #6fe3ff, #0cc3ff); transition: width var(--duration) cubic-bezier(.2,.8,.2,1); }

  /* Modal */
  .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(4,18,28,.55); backdrop-filter: blur(2px); z-index: 999; }
  body.modal-open .overlay{ display:flex; }  body.modal-open .wrap{ filter: blur(1px) opacity(.95); }
  .modal{ width:min(720px, 92vw); background: linear-gradient(180deg,#081d2e,#071826); border:1px solid #9fe6ff2a; border-radius:20px; box-shadow: 0 20px 60px #000a, 0 0 0 1px #ffffff12 inset; padding: 20px 22px 24px; position:relative; transform: translateY(10px) scale(.98); opacity:0; transition: transform .18s ease, opacity .18s ease; }
  body.modal-open .modal{ transform: translateY(0) scale(1); opacity:1; }
  .modal header{ display:flex; align-items:flex-start; gap:12px; margin-bottom:8px; }
  .modal .modal-ico{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center; background:#0e3b54; border:1px solid #bdf2ff22; font-size:24px; }
  .modal h2{ margin:4px 0 0; font-size: clamp(20px, 2.6vw, 28px); line-height:1.1; }
  .modal p{ margin:10px 0 0; opacity:.9 }
  .modal .actions{ margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; }
  .chip{ padding:8px 12px; border-radius:999px; border:1px solid #6fe3ff44; background:#0a2a3f; font-size:13px; }
  .close{ position:absolute; top:10px; right:10px; width:42px; height:42px; border-radius:12px; border:1px solid #9fe6ff33; background:#ffffff10; display:grid; place-items:center; cursor:pointer; }
  .close:hover{ background:#ffffff18 } .close:active{ transform:translateY(0) scale(.98) } .close span{ font-size:20px; }

  @media (max-width: 900px){
    :root{ --radius: 440px; --orbit-shift: 70px; --card-w: 200px; --card-h: 104px }
  }
  @media (max-width: 640px){
    :root{ --radius: 320px; --orbit-shift: 60px; --card-w: 180px; --card-h: 96px }
    .progress{ width: 240px }
  }
</style>
</head>
<body>
<div class="wrap" aria-label="3D rotating module menu">
  <div class="scene" id="scene">
    <div class="world" id="world">

      <div class="orbit">
        <div class="ring" id="ring"></div>
      </div>

      <div class="hub" aria-hidden="false">
        <button class="hubbtn" id="hubbtn" type="button" aria-label="Open NicheRMS">
          <div class="shield"></div>
          <h1>NicheRMS</h1>
          <small>Click to open</small>
        </button>
      </div>

    </div>
  </div>

  <div class="controls">
    <button class="btn" id="prev" aria-label="Previous">
      <svg viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <button class="btn" id="next" aria-label="Next">
      <svg viewBox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
    </button>
  </div>
</div>

<!-- Modal overlay -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <button class="close" id="modal-close" aria-label="Close dialog"><span>‚úï</span></button>
    <header>
      <div class="modal-ico" id="modal-ico">‚òÅÔ∏è</div>
      <h2 id="modal-title">Module Title</h2>
    </header>
    <p id="modal-body"> Placeholder text ‚Äî replace with real content per module. </p>
    <div class="actions" id="modal-actions">
      <div class="chip">Overview</div>
      <div class="chip">Tasks</div>
      <div class="chip">Documents</div>
      <div class="chip">Reports</div>
    </div>
  </div>
</div>

<script>
const modules = [
  { title: "NicheRMS", icon: "‚òÅÔ∏è", desc: "Platform overview", content: "Dummy text for NicheRMS. Use this modal to link to platform overview, documentation, and high-level demos." },
  { title: "Custody Management", icon: "üë§", desc: "Detention, booking & handover", content: "Dummy text for Custody Management..." },
  { title: "Case Prep & Criminal Justice", icon: "‚öñÔ∏è", desc: "Disclosure & submissions", content: "Dummy text for Case Preparation & Criminal Justice..." },
  { title: "Property Management", icon: "üè†", desc: "Seizure, cataloguing & chain", content: "Dummy text for Property Management..." },
  { title: "Vulnerability Management", icon: "üß©", desc: "Risk & safeguarding", content: "Dummy text for Vulnerability Management..." },
  { title: "Investigation & Crime", icon: "üîí", desc: "IO, tasks & solvability", content: "Dummy text for Investigation & Crime..." },
  { title: "Forensics Management", icon: "üîé", desc: "Exhibits & lab liaison", content: "Dummy text for Forensics Management..." },
  { title: "Intelligence Management", icon: "üß†", desc: "Links, entities & briefing", content: "Dummy text for Intelligence Management..." }
];

const ring = document.getElementById('ring');
const bar = document.getElementById('bar');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const hubbtn = document.getElementById('hubbtn');

const overlay = document.getElementById('overlay');
const modalTitle = document.getElementById('modal-title');
const modalBody  = document.getElementById('modal-body');
const modalIco   = document.getElementById('modal-ico');
const modalClose = document.getElementById('modal-close');

const cfg = {
  radius: parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--radius')),
  minScale: parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--min-scale')),
  maxBlur: parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--max-blur')),
  minOpacity: parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--min-opacity')),
};

let angle = 0;
let targetAngle = 0;
const step = 360 / modules.length;
let animId = null;
let blocked = false;
let lastFocused = null;

// Build items (node + card)
const items = modules.map((m, i) => {
  const node = document.createElement('div');
  node.className = 'node';
  node.dataset.baseAngle = i * step;

  const card = document.createElement('button');
  card.className = 'card';
  card.setAttribute('type','button');
  card.setAttribute('aria-label', m.title);
  card.innerHTML = `
    <div class="ico">${m.icon}</div>
    <div class="txt">
      <h3>${m.title}</h3>
      <p>${m.desc}</p>
    </div>`;

  node.appendChild(card);
  ring.appendChild(node);

  card.addEventListener('click', () => { focusIndex(i); openModal(i, card); });

  return { node, card, index: i };
});

hubbtn.addEventListener('click', () => openModal(0, hubbtn));

function focusIndex(i){ targetAngle = -i * step; tweenTo(targetAngle); }
function next(){ if(blocked) return; targetAngle -= step; tweenTo(targetAngle); }
function prev(){ if(blocked) return; targetAngle += step; tweenTo(targetAngle); }

nextBtn.addEventListener('click', next);
prevBtn.addEventListener('click', prev);
window.addEventListener('keydown', e=>{
  if (blocked && e.key === 'Escape') { closeModal(); return; }
  if (blocked) return;
  if (e.key === 'ArrowRight') next();
  if (e.key === 'ArrowLeft') prev();
});

// Drag to rotate ‚Äî don't hijack clicks on cards
(()=>{
  let dragging=false, sx=0, sa=0, moved=false;
  ring.style.pointerEvents='auto';
  ring.addEventListener('pointerdown', e=>{
    if(blocked) return;
    if (e.target.closest('.card')) return;  // ignore, let the card click win
    dragging=true; moved=false; sx=e.clientX; sa=targetAngle; ring.setPointerCapture(e.pointerId);
  });
  ring.addEventListener('pointermove', e=>{
    if(!dragging || blocked) return;
    const dx = e.clientX - sx;
    if (Math.abs(dx) > 2) moved=true;
    targetAngle = sa + dx * 0.2;
    angle = targetAngle; render();
  });
  const end=e=>{ if(!dragging) return; dragging=false; ring.releasePointerCapture?.(e.pointerId); if (moved) snapToNearest(); };
  ring.addEventListener('pointerup', end);
  ring.addEventListener('pointercancel', end);
})();

ring.addEventListener('wheel', e=>{
  e.preventDefault();
  if(blocked) return;
  targetAngle += Math.sign(e.deltaY) * -step;
  tweenTo(targetAngle);
},{passive:false});

// Fallback: central click opens the front-most item
ring.addEventListener('click', e=>{
  if (blocked) return;
  if (e.target.closest('.card')) return; // handled by card
  const sceneRect = document.querySelector('.scene').getBoundingClientRect();
  const cx = sceneRect.left + sceneRect.width/2;
  const cy = sceneRect.top + sceneRect.height/2 + parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--orbit-shift'));
  const dx = e.clientX - cx;
  const dy = e.clientY - cy;
  const dist = Math.hypot(dx, dy);
  if (dist < 220) {
    const frontIndex = getFrontIndex();
    openModal(frontIndex, items[frontIndex].card);
  }
});

function getFrontIndex(){
  let best = 0, bestZ = -Infinity;
  items.forEach(({node}, i)=>{
    const base = parseFloat(node.dataset.baseAngle);
    const local = base + angle;
    const z = Math.cos(local * Math.PI/180) * cfg.radius;
    if (z > bestZ) { bestZ = z; best = i; }
  });
  return best;
}

function snapToNearest(){ targetAngle = Math.round(targetAngle/step)*step; tweenTo(targetAngle); }

function tweenTo(dest){
  cancelAnimationFrame(animId);
  const start = angle;
  const delta = normAngle(dest - start);
  const dur = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--duration'));
  const t0 = performance.now();
  (function tick(now){
    const t = Math.min(1, (now - t0)/dur);
    const ease = t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;
    angle = start + delta * ease;
    render();
    if (t < 1) animId = requestAnimationFrame(tick);
    else { angle = dest; render(); }
  })(performance.now());
}

function normAngle(a){ a = ((a + 180) % 360) - 180; return a; }

function render(){
  ring.style.transform = `rotateY(${angle}deg)`;
  const progress = ((-angle % 360) + 360) % 360 / 360;
  bar.style.width = `${progress*100}%`;

  items.forEach(({node, card})=>{
    const base = parseFloat(node.dataset.baseAngle);
    const local = base + angle;
    const rad = local * Math.PI/180;
    const z = Math.cos(rad) * cfg.radius;
    const zNorm = (z + cfg.radius) / (2*cfg.radius);

    const scale = cfg.minScale + (1-cfg.minScale)*zNorm;
    const opacity = cfg.minOpacity + (1-cfg.minOpacity)*zNorm;
    const blur = (1 - zNorm) * cfg.maxBlur;

    node.style.transform = `rotateY(${base}deg) translateZ(${cfg.radius}px)`;
    node.style.zIndex = Math.round(z);
    card.style.transform = `translate(-50%, -50%) scale(${scale})`;
    card.style.opacity = opacity.toFixed(3);
    card.style.filter = `blur(${blur.toFixed(2)}px)`;
  });
}

// Modal controls
function openModal(i, triggerEl){
  const m = modules[i];
  modalTitle.textContent = m.title;
  modalBody.textContent  = m.content || "Placeholder content.";
  modalIco.textContent   = m.icon || "‚ÑπÔ∏è";
  lastFocused = triggerEl || document.activeElement;
  document.body.classList.add('modal-open');
  overlay.setAttribute('aria-hidden','false');
  modalClose.focus();
  blocked = true;
}
function closeModal(){
  document.body.classList.remove('modal-open');
  overlay.setAttribute('aria-hidden','true');
  blocked = false;
  if (lastFocused && lastFocused.focus) lastFocused.focus();
}
overlay.addEventListener('click', (e)=>{ if (e.target === overlay) closeModal(); });
modalClose.addEventListener('click', closeModal);

render();
focusIndex(0);
</script>
</body>
</html>
